# ðŸ“± WhatsApp Integration Setup Guide

This guide shows you how to integrate WhatsApp with your Quran Progress Tracker to send weekly reports.

## ðŸš€ Quick Start (Simplest Method)

### Option 1: WhatsApp Link (No API Required)

This is the easiest way to get started - no API setup needed!

1. **Use the WhatsApp Share Button**
   - Go to any student's weekly summary
   - Click "Share via WhatsApp" button
   - Enter the student's phone number (with country code)
   - Click "Generate WhatsApp Link"
   - Click "Open in WhatsApp" to send the message

2. **API Endpoint**
   ```
   GET /api/whatsapp/weekly/{student_id}/whatsapp-link?phone_number=+1234567890&week_start=2025-09-01
   ```

## ðŸ”§ Advanced Setup (Automated Sending)

### Option 2: WhatsApp Business API

For automated sending without manual intervention:

#### Step 1: Get WhatsApp Business API Access

1. **Create Facebook Developer Account**
   - Go to [developers.facebook.com](https://developers.facebook.com)
   - Create a new app
   - Add WhatsApp Business API product

2. **Get Required Credentials**
   - Access Token
   - Phone Number ID
   - Webhook URL (for receiving messages)

#### Step 2: Configure Environment Variables

Add to your Vercel environment variables:

```bash
WHATSAPP_ACCESS_TOKEN=your_access_token_here
WHATSAPP_PHONE_NUMBER_ID=your_phone_number_id_here
```

#### Step 3: Use Automated Sending

```bash
POST /api/whatsapp/weekly/{student_id}/send-whatsapp?phone_number=+1234567890
```

## ðŸ“‹ Available Endpoints

### 1. Generate WhatsApp Link
```http
GET /api/whatsapp/weekly/{student_id}/whatsapp-link
```
**Parameters:**
- `phone_number` (required): Student's phone number with country code
- `week_start` (optional): Week start date

**Response:**
```json
{
  "student_name": "Hafsa",
  "phone_number": "+1234567890",
  "whatsapp_link": "https://wa.me/1234567890?text=...",
  "message_preview": "ðŸ“š Weekly Quran Progress Report..."
}
```

### 2. Send via WhatsApp Business API
```http
POST /api/whatsapp/weekly/{student_id}/send-whatsapp
```
**Parameters:**
- `phone_number` (required): Student's phone number with country code
- `week_start` (optional): Week start date
- `report_url` (optional): URL to PDF report

### 3. Preview Message
```http
GET /api/whatsapp/weekly/{student_id}/whatsapp-preview
```

## ðŸŽ¯ Frontend Integration

### Add WhatsApp Share Button

```jsx
import WhatsAppShare from './components/WhatsAppShare';

// In your component
<WhatsAppShare 
  studentId={student.id} 
  studentName={student.name} 
  weekStart="2025-09-01" 
/>
```

## ðŸ“± Message Format

The WhatsApp message includes:

```
ðŸ“š Weekly Quran Progress Report

Assalamu Alaikum [Student Name],

Here's your weekly progress summary:

ðŸ“Š This Week's Progress:
â€¢ New Memorization: [Content]
â€¢ Recent Revision: [Content]
â€¢ Old Revision: [Content]
â€¢ Teacher Notes: [Notes]

ðŸ“ˆ Summary:
[AI-generated summary]

Keep up the excellent work! May Allah bless your efforts. Ameen.

---
Generated by Quran Progress Tracker
```

## ðŸ”’ Security Considerations

1. **Phone Number Privacy**
   - Store phone numbers securely
   - Only send to verified numbers
   - Implement opt-in/opt-out functionality

2. **Rate Limiting**
   - WhatsApp has sending limits
   - Implement proper rate limiting
   - Queue messages if needed

3. **Error Handling**
   - Handle invalid phone numbers
   - Retry failed sends
   - Log all attempts

## ðŸ’¡ Tips for Success

1. **Test First**
   - Always test with your own number first
   - Verify message format and content

2. **Phone Number Format**
   - Always include country code (+1, +44, etc.)
   - Remove spaces and special characters
   - Validate format before sending

3. **Message Length**
   - WhatsApp has character limits
   - Keep messages concise but informative
   - Use emojis for better readability

4. **Timing**
   - Send reports at appropriate times
   - Consider time zones
   - Avoid sending during prayer times

## ðŸ†˜ Troubleshooting

### Common Issues

1. **"WhatsApp credentials not configured"**
   - Set environment variables in Vercel
   - Check token validity

2. **"Failed to send WhatsApp message"**
   - Verify phone number format
   - Check API rate limits
   - Ensure valid access token

3. **"Student not found"**
   - Verify student ID exists
   - Check database connection

### Getting Help

- Check Vercel logs for detailed error messages
- Test API endpoints directly with curl/Postman
- Verify WhatsApp Business API setup

## ðŸŽ‰ You're Ready!

Once set up, you can:
- âœ… Generate WhatsApp links for any student
- âœ… Send automated weekly reports
- âœ… Preview messages before sending
- âœ… Include PDF reports as attachments

Your students will receive beautiful, formatted progress reports directly in WhatsApp! ðŸ“±âœ¨
